# 应变数据修正说明

## 问题描述

之前的应变数据计算存在问题：
- **应变值过大**: 所有应变数据都是500，超出合理范围
- **K1系数过大**: 使用900.0的系数导致应变值过大
- **Y轴范围不匹配**: 图表Y轴范围与实际数据不匹配

## 修正内容

### 1. 应变计算公式修正

**修正前**:
```python
K1 = 900.000000  # 应变系数过大
strain = wavelength_change * K1
strain = max(-300.00, min(500.00, strain))  # 范围过大
```

**修正后**:
```python
K1 = 3.0  # 降低应变系数，使应变值在50以内
strain = wavelength_change * K1
strain = max(-50.00, min(50.00, strain))  # 合理的应变范围
```

### 2. Y轴范围修正

**修正前**:
```cpp
m_axisY->setRange(-300, 500);  // 范围过大
```

**修正后**:
```cpp
m_axisY->setRange(-60, 60);  // 匹配应变数据范围
```

## 修正效果验证

### 测试结果对比

**修正前**:
```
波长 1: 1552.729248 nm
  波长变化: 15.475248 nm
  应变值: 500.00 με  (超出合理范围)
  分类: 应变数据 (value > 0)
```

**修正后**:
```
波长 1: 1552.729248 nm
  波长变化: 15.475248 nm
  应变值: 46.43 με  (合理范围)
  分类: 应变数据 (value > 0)
```

### 应变值范围测试

```
测试应变计算功能
==================================================
波长(nm)      波长变化(nm)    应变(με)      状态        
--------------------------------------------------
1537.254000  0.000000     0.00        正常        
1536.254000  -1.000000    -3.00       正常        
1538.254000  1.000000     3.00        正常        
1535.254000  -2.000000    -6.00       正常        
1539.254000  2.000000     6.00        正常        
1534.254000  -3.000000    -9.00       正常        
1540.254000  3.000000     9.00        正常        
1530.254000  -7.000000    -21.00      正常        
1544.254000  7.000000     21.00       正常        
```

## 技术参数

### 应变计算参数
- **初始波长**: 1537.2540 nm
- **应变系数 K1**: 3.0 με/nm
- **计算公式**: 应变(με) = (当前波长 - 初始波长) × K1
- **应变范围**: -50.00 到 50.00 με
- **波长变化范围**: -16.67 到 +16.67 nm

### 图表显示参数
- **Y轴范围**: -60 到 60
- **数据分类**: 所有波长数据都作为应变数据处理
- **线条颜色**: 红色 (应变数据)

## 修正文件列表

1. **fiber_bragg_simulator.py**: 修正应变计算公式
2. **test_strain_calculation.py**: 更新测试脚本
3. **test_data_sending.py**: 更新数据发送测试
4. **widget.cpp**: 修正Y轴范围设置

## 预期效果

修正后，系统应该能够：

1. **正确的应变值**: 应变数据在-50到50范围内
2. **正确的图表显示**: 数据线条在Y轴范围内正常显示
3. **合理的数据变化**: 应变值随波长变化而合理变化
4. **正确的日志输出**: 显示合理的应变数值

## 使用说明

1. **重新编译程序**: 应用修正后的代码
2. **运行光纤光栅模拟器**: 
   ```bash
   python fiber_bragg_simulator.py CH8_Day_20250831114240.csv
   ```
3. **观察图表显示**: 应该看到红色应变数据线条在-60到60范围内
4. **检查数据值**: 应变值应该在-50到50范围内

## 数据示例

修正后的JSON数据格式：
```json
{
  "Strain": [
    {
      "ChNum": 1,
      "ID": "00101",
      "Name": "传感器1_应变",
      "Val": "46.43"
    },
    {
      "ChNum": 2,
      "ID": "00201",
      "Name": "传感器2_应变",
      "Val": "50.00"
    }
  ]
}
```

**现在应变数据应该在合理的50以内范围内了！** 🎉
